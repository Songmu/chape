# `chapel` - mp3ファイルのメタデータ編集ツール

## 概要

このツールは、mp3ファイルのメタデータを編集するためのコマンドラインツールです。サポートするのはmp3ファイルのみに限ります。

## メタデータ形式

メタデータはYAMLで表現され、chapelはそれを入出力として使用します。すべてのフィールドはオプショナルで、必要なものだけ記述できます。

```yaml
# 基本メタデータ (ID3v2タグ)
title: "曲名 / ポッドキャストエピソードタイトル"
artist: "アーティスト名 / ポッドキャスター名"
album: "アルバム名 / ポッドキャスト名"
albumArtist: "アルバムアーティスト名"  # コンピレーションアルバム用
year: 2024  # リリース年
track: 1  # トラック番号
totalTracks: 12  # 総トラック数
disc: 1  # ディスク番号
totalDiscs: 1  # 総ディスク数
genre: "ジャンル / Podcast"
comment: "コメント"
composer: "作曲者"
publisher: "パブリッシャー"  # レーベル名
bpm: 120  # テンポ

# チャプター情報
chapters:
  - "0:00 イントロ"
  - "1:30 Aメロ"
  - "3:00 サビ"
  - "4:30 ブリッジ"
  - "5:45 アウトロ"

# カバーアート (Base64エンコード or ファイルパス)
artwork: "path/to/cover.jpg"  # または base64エンコードされた画像データ

# 歌詞
lyrics: |
  ここに歌詞を
  複数行で
  記述できます
```

### フォーマット仕様

- **ID3v2.4標準タグ対応**: 一般的に使用される主要なタグフィールドを網羅
- **チャプター形式**: シンプルな `"開始時間 タイトル"` 形式を採用（開始時間は `MM:SS` または `HH:MM:SS` 形式）
- **すべてのフィールドはオプショナル**: 必要なものだけ記述可能

## 利用方法

### メタデータのダンプ (`dump`)

mp3を指定して、メタデータを標準出力にダンプします。

```console
% chapel dump {{mp3ファイル}} > dump.yaml
```

### メタデータの適用 (`apply`)

標準入力からYAML形式のメタデータを読み込み、指定したmp3ファイルに適用します。適用する前に、適用差分を表示しながらプロンプトで確認を求めます。

```console
% chapel apply {{mp3ファイル}} < dump.yaml
```

### メタデータの直接編集

mp3ファイルを直接指定してメタデータを編集します。

```console
% chapel {{mp3ファイル}}
```

処理としては、一時ファイルにメタデータをダンプし、それを "EDITOR" 環境変数に指定されたエディタでで開きます。ファイル編集後、その内容がmp3ファイルに反映されます。`apply` コマンドと同様に、適用前に差分を確認するプロンプトが表示されます。

## 利用ライブラリ
- github.com/goccy/go-yaml
    - YAML設定ファイルの読み書きのために利用。YAMLライブラリは色々ありますがこれを使います
- github.com/Songmu/prompter
    - プロンプトの表示と確認のために利用。ユーザに適用前の差分を確認させるために使用します
- github.com/sergi/go-diff/diffmatchpatch
    - 差分の計算と表示のために利用。YAMLファイルとmp3ファイルのメタデータの差分を計算するために使用します
- github.com/dhowden/tag
    - mp3ファイルのメタデータの読み書きのために利用

## 参考
- <https://github.com/Songmu/podbard>
    - ポッドキャスト配信ツール
    - <https://github.com/Songmu/podbard/blob/main/internal/cast/chapter.go> 辺りにチャプターに関する処理が書かれているので参考にして下さい
